<mat-toolbar color="primary">
  <span>ReviewPackets</span>
</mat-toolbar>

<div class="app-container">
  <div class="section">
    <div class="section-title">1. Upload Main Dump</div>
    <input type="file" accept=".xlsx,.xls,.csv" (change)="onDumpSelected($event)" />
    <div *ngIf="dumpFileName">Selected: {{ dumpFileName }}</div>
  </div>

  <div class="section">
    <div class="section-title">2. Provide Issue Keys</div>
    <div style="display:flex; gap:16px; flex-wrap: wrap;">
      <div>
        <label>Upload keys file</label><br />
        <input type="file" accept=".xlsx,.xls,.csv" (change)="onKeysSelected($event)" />
        <div *ngIf="keysFileName">Selected: {{ keysFileName }}</div>
      </div>
      <div style="flex:1; min-width: 280px;">
        <mat-form-field appearance="outline" style="width: 100%;">
          <mat-label>Paste issue keys (comma-separated)</mat-label>
          <textarea matInput rows="3" [formControl]="form.get('keysText')"></textarea>
        </mat-form-field>
        <button mat-flat-button color="primary" (click)="submitKeysText()">Apply Keys</button>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">3. Select Filters</div>
    <mat-form-field appearance="outline" style="width: 100%;">
      <mat-label>Columns to review</mat-label>
      <mat-select multiple [(value)]="selectedFilters">
        <mat-option *ngFor="let header of headers" [value]="header">
          {{ header }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <button mat-flat-button color="primary" (click)="generatePreview()">Generate Preview</button>
  </div>

  <div class="section">
    <div class="section-title">4. Preview Table</div>
    <div *ngIf="isLoading" style="padding: 12px;">
      <mat-progress-spinner diameter="32" mode="indeterminate"></mat-progress-spinner>
    </div>
    <div class="table-wrapper" *ngIf="previewRows.length">
      <table mat-table [dataSource]="previewRows">
        <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
          <th mat-header-cell *matHeaderCellDef>{{ column }}</th>
          <td mat-cell *matCellDef="let row">{{ row[column] }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <button mat-stroked-button color="accent" (click)="exportCsv()" [disabled]="!previewRows.length">
      Export CSV
    </button>
  </div>
</div>
